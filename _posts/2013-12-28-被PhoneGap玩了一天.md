---
title: 被PhoneGap玩了一天
tags: phonegap
category: Web2.0
---
想玩phonegap的原因很简单:我缺一个好用的课程表软件...对于我这种经常不上课并且完全没可能记住课程的地点和时间的人,一款好的课程管理软件是必须的.之前一直是用的**课程格子**.UI做的很漂亮,功能做的很差劲.明明是一款课程管理软件,偏偏想做成社交软件,什么分享什么好友之类的功能,真是很无聊...谁TM没事干用你这个东西交友?就是想找一个学校一个学院的妹纸也有人人在那里,哪里轮的上用课程软件呢...花点心思在怎样把本职功能做好才是正经事.

作为一名学软件的人,没有好用的软件怎么办?**!DIY**.可是我早已和Java结仇了.我实在是太讨厌Java的语法和机制了,又笨又重.简直傻得可怜.为什么android选择了你,我表示费解,可能比较高层又比较快.可是也比较重比较笨.我坚决不能容忍.所以不用Java想玩Android应用开发那只有一条路可以走了(C 和 C++ 太底层了),那就是用**html5**技术了.


以前看新闻多多少少也了解了几个著名的html5 mobile开发框架,像是`phonegap`,`senchatouch`等等.phonegap看到的比较多,就选择了phonegap来尝试一下.

##下面详细介绍怎样在mac上建立`phonegap`的开发环境:

**Android相关**

1. 首先我们需要`android SDK`.google提供了`adt-bundle`,里面集成了SDK和作为IDE使用的`eclipse`.很方便.如果已经有`eclipse`了,直接下载sdk也行.网址google.

2. 如果下载的是`adt-bundle`,那么安卓方面已经搞定了.如果用的是已经存在的eclipse,比如eclipse EE.那么SDK下载好了以后,需要配置eclipse的ADT插件.

3. 在线安装ADT:
   1. 打开eclipse,help->install new software .如图所示：![](http://ww3.sinaimg.cn/large/9b85365djw1f23bya3lazj20o70h9q55.jpg)
   2. 在`work with`里面填写`https://dl-ssl.google.com/android/eclipse/`,然后下面就会出现`develp tools`,打上勾,然后切记:**Contact update sites during install to find required software前面的勾去掉!!!**.要不然会卡死.估计是GFW的原因...我在这上面卡死了好几次..每次都觉得重启会不会好点..然后果然一点都没好.后来google才知道..原谅我安装东西都不看选项.
   3. 等ADT安装好,就可以去`Preferences`里面看见`Android`的选项,然后将SDK的位置填一下即可.

4. 离线安装ADT
   1. 谷歌没有直接提供ADT下载的地址,不过很好破解.`https://dl.google.com/android/ADT-22.2.1.zip`.将版本号换位想要下载的版本号即可.
   2. 一样是打开eclipse,选择`help->install new software`,点击`add`,填上名字,然后选择`archive`,选择下载的zip文件就行了.同样记住:**务必不要勾选`Contact update sites during install to find required software选项**.
   3. 去`Preferences`,选择`Android`,填写android SDK的位置.





还需要提一个坑爹的问题,因为我们要玩的是`phonegap`,也就是`html`,`css`,`js`.可是如果你使用的是`adt-bundle`里面提供的eclipse的话,那么恭喜,他无法识别web文件类型.也就是没有语法高亮等东西.这对于我来说无法容忍.Google搜索似乎提出这个问题的不多.当然有人提供了解决办法.那就是是为adt-bundle里面的eclipse安装web-tools插件.自行折腾去吧.我选择使用eclipse EE版本.虽然后来我用的都是sublime.



**phonegap 相关**

- phonegap主要是安装`cordova`这个命令行工具.他以node的包形式存在.所以先装好node.然后利用npm全局安装即可.`npm -g install cordova`.


- 为了让cordova能够正常工作,我们需要配置一下PATH变量.暴露出我们下载的安卓SDK的一些工具.将`path_to_your_android_sdk/tools` 和`path_to_your_android_sdk/platforms-tools`添加进环境变量.配置`.bashrc`或者`.zshrc`.(表示zsh真心好).



##至此开发环境已经搭建完毕,下面介绍一下怎么开始一个项目

我们可以利用eclipse直接新建一个android工程,然后修改其中的java等文件.不过这很麻烦.我们选择利用`cordova`命令在命令行中帮我们直接初始化好一个项目,使得我们只需要编写`html`,`css`,`js`.(回避java.>O<).

```bash
cordova creae hello com.example.hello  "helloworld"
cd hello
cordova platform add android
cordova build
```

- `hello`为我们总工程文件夹,上述命令运行完毕后,里面会有一个platfroms文件.里面会有`android`.
- 打开eclipse,选择`android project from existing code`,选择`hello->platforms->android`即可.
- eclipse会打开两个工程.一个是`hello`,一个是`hello-CordovaLib`,不要在意`hello-CordovaLib`这个细节.
- 在`hello`工程里面,我们所要编写的源码文件存放在`assets/www`目录下.




##使用有感

在eclipse建好工程以后就可以运行项目了,在项目上右键,`run as->android application`,这里面涉及到配置虚拟机,很简单.不赘述了.我想说的是:**虚拟机的性能真心让我和我的小伙伴们都惊呆了**.我一向认为我的mac性能已经非常棒了.几乎很少卡顿,用了一年多,感觉流畅的不得了.可是安卓虚拟机告诉我,我真是too young to simple.实在是太慢了.我等了好几分钟才初始化完毕.初始化慢点也还能忍.可是初始化好了还是非常慢.用鼠标模拟拖动简直慢的让人等到天荒地老.

虚拟机的性能把我吓坏了.我决定再也不用他了.幸好android不像ios那样真机调试麻烦的要死.只要插上线,然后选择`usb调试`模式就行了.真机第一次插上时,可能eclipse会显示`offline`,拔下usb线,重新插上即可.

真机的速度果然让人欣慰了.不过phonegap的性能让我心碎了.

**在这里简单插播一下我所理解的phonegap原理:**


- phonegap应用就是一个能够调用本地功能的web应用.传统web应用是不可以调用本地功能的,比如文件存储,摄像头,震动等等.如果要开发一个应用,不调用这些功能是不可能的.所以phonegap将这些功能利用js接口暴露出来提供开发者调用.这是phonegap做的事.

- 除掉phonegap提供的本地功能以外,其他方面就和开发web应用一模一样.当程序运行时,通过调用手机的webkit引擎渲染页面,执行js逻辑.

- 所以一般利用phonegap开发应用时,还要配合`jquery mobile`等开发移动网站的框架.因为本质上phonegap应用就是一个可以调用本地功能的web应用.

- 因为手机的浏览器引擎性能很差,这是phoengap应用的瓶颈所在.

**回到正题**

每次学习一门技术,我都习惯先看书,这次也不例外.去京东上搜索phonegap,有几本2012年出版的书,其中比较有名的是*PhoneGap实战*.华章出版的.华章出版的书还是靠谱的.不过价格真心贵.还好我抑制住了冲动没有买,而是去图书馆借了一本.

现在想想,我真是明智.这本书就和我以前买的`node.js入门`一样的.简直坑爹.内容水的要死.一点有价值的东西没有.文字水平也是极差.官网的API翻译就占了一大章.html代码写的也是水平不高.总之,一本烂书.

一开始写了几个页面感觉速度还可以.这里说明一下:在`index.html`里面链接不链接`cordova.js`(提供本地功能js接口的文件,phonegap提供)速度差异非常明显.不连接的话,手机上测试的时候程序启动速度慢的死人,大概3-4s,链接的话只要1s左右.不过链接的话,无法使用chrome浏览器调试代码.所以我一般开发的时候注释掉,然后在eclipe打包的时候在取消注释.真是麻烦无比.可能是我自己没有找打更好的解决办法.

等到我写两个两个页面并且测试跳转的时候,我泪奔了..那个效果卡顿的..简直让人伤心..没有页面跳转怎么做应用呢..我想jquery-mobile应该已经优化到很不错了.就算我手动优化,也不可能有显著的提升:




```html
<div data-role="page" id="page1">
	<h1>this is page1</h1>
	<a data-role="button" href="#page2" data-transition="slide">
		go to page2
	</a>
</div>

<div data-role="page" id="page2">
	<h1>this is page2</h1>
	<a data-role="button" href="#page1" data-transition="slide">
		go to page1
	</a>
</div>
```


页面可以用css做的很好看.可是当我点击按钮跳转的时候,总是会卡顿....这个怎么玩嘛...等我到了这一步的时候,我果断决定放弃了.写篇博文回去看美剧把.

以前写程序从没想过性能的问题,可能是我一直接触的是高级的设备并且写的程序一般比较小.所以体会不深.这次真是是深有体会.连换个页面都要卡顿,我想这确实是无法让人接受的.

好吧,我的课程表是没有希望了,只能等到我买iphone,然后用objective-C写一个给自己玩了.现在用安卓是没救了.

希望以后移动设备具有更加强大的浏览器渲染功能,如果那样就好了.用web技术来做开发实际上还是一件非常惬意的事情的.起码用css来做页面比用原生的layout要好做的多,也很容易做的漂亮.






















​	