---
title: "关于字符编码"
tags: encoding utf-8
---

很早之前就碰到过"乱码"这个现象,当时非常困惑,完全不能理解发生了什么.

上大学以后,虽然开始接触计算机,不过我就没看到过具体讲解字符编码的内容.对这个领域始终是感到非常模糊.

不过,最近好像豁然开朗了一下,感觉突然就明白了这个问题.


**我来解释一下我所理解的字符编码**

首先,所有的字符(或者说所有的信息)都是以二进制串的形式存储在计算机中.所谓的编码就是**映射字符与相应的串之间的规则**。这样的映射可以任意定义，只要大家都遵守就行了。

比如非常经典的ASCII码，就将英文中的字符映射为一个字节。比如，`A`这个字符编码为65，存储在计算机中为`01000001`，占据一个字节。

其他的所有字符编码都是同理，比如汉字的经典编码GBK。

以我的名字举例，丁这个汉字，GBK编码为`B6A1`，存储为二进制是`10110110 10100001`（直接将B6A1换成二进制），两个字节。

用shell查看内部字节可以看出，如图：



![](http://ww3.sinaimg.cn/large/9b85365djw1f23cmmpfu1j20ex01qaa9.jpg)



同样的道理，如果使用utf-8编码，丁在unicode字符集中的编号为4E01，但他的二进制并不是简单的将编号翻译为对应的二进制。这就是utf有很多系列的原因（utf-8，utf-16，utf-32）。首先，字符在字符集中有他的唯一标识编号，但是怎么把这个编号存储在计算机上却有很多选择。例如，我想存储编号10，我可以存储为字节的20，每次在计算机中取得数字后除以二就得到了我的编号。至于为什么要这么干，是因为兼容性和方便解码的考虑。

utf-8的编码机制不算很复杂，wiki里面说的很清楚，这里就不在赘述了。

现在来说说为什么要有乱码。

当计算机打开一个文本文件的时候，他必须要知道这个是什么编码的。否则无法解码，因为在计算机眼中，一切都是字节流。但是不同的编码下相同的字节有不同的含义。同样是ABCD，在某一个编码下可能表示“丁“，在另一个编码下可能表示的就是“王”了。所以计算机需要知道。打开文本文件的时候，要么手动指定编码，如果不指定计算机就用默认编码。有一点，就我所知的所有编码，都是兼容ascii的，也就是英文字母肯定不会乱码的。

如果一个文本文件是用GBK存储的，你却指定要用UTF-8打开，那么**乱码**现象也就产生了。会产生完全无意义的字符。对计算机而言，他只是用指定的解码方式来解码文件而已。



